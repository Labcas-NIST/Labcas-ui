<html>
<header>
<meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="/labcas-ui/assets/img/apple-icon.png">
    <link rel="icon" type="image/png" href="/labcas-ui/assets/img/favicon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Labcas 3.0</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" />
    <!-- CSS Files -->
    <link href="/labcas-ui/assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/labcas-ui/assets/css/light-bootstrap-dashboard.css?v=2.0.1" rel="stylesheet" />
    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link href="/labcas-ui/assets/css/demo.css" rel="stylesheet" />
<script src="/labcas-ui/assets/js/plugins/js.cookie.js"></script>
<script src="/labcas-ui/assets/js/core/jquery-3.5.1.min.js" type="text/javascript"></script>
<script src="/labcas-ui/assets/js/core/jquery-3.5.1.min.js" type="text/javascript"></script>
<script src="/labcas-ui/assets/js/core/popper.min.js" type="text/javascript"></script>
<script src="/labcas-ui/assets/js/core/bootstrap.min.js" type="text/javascript"></script>
<script src="/labcas-ui/assets/js/labcas/utils.js?version=3.0.0"></script>
<script>
	
	$().ready(function() {
		if (Cookies.get('user') == "Sign in"){
            $('#loggedin_download_content').hide();
        }
		if (Cookies.get('user') == "Sign in" && !Cookies.get('accepted')){
			//alert("In order to download, please login or create an account in order to accept DATA USE AGREEMENT.");
            //$('#redirectModal').modal('show');
            check_labcas_acceptance("anonymous");
            //window.location.replace("/");
		}else{
			var files = JSON.parse(localStorage.getItem("download_list"));
			var filesize = parseInt(localStorage.getItem("download_size"));
            var filecount = localStorage.getItem("download_count") ? parseInt(localStorage.getItem("download_count")): Object.keys(files).length;

			if (files && filecount > 0 && Object.keys(files).length > 0){
				if ( (filesize > parseInt(localStorage.getItem("file_size_threshold_for_download_alert_trigger")) || filecount > parseInt(localStorage.getItem("file_count_threshold_for_download_alert_trigger")))  && (!localStorage.getItem("continue_download_flag") || localStorage.getItem("continue_download_flag") == "")){
                    localStorage.setItem("continue_download_flag","")
					console.log("Files");
					console.log(files);
					console.log(filesize);
					checkSize(Object.keys(files).length, humanFileSize(parseInt(localStorage.getItem("file_size_threshold_for_download_alert_trigger"))), localStorage.getItem("file_count_threshold_for_download_alert_trigger"));
					return;
				}
                localStorage.setItem("continue_download_flag","")
				var download_type = "multiple";
				if (filecount == 1){
					download_type = "single";	
				}
				var first_file = Object.keys(files)[0];
				var flag = download_file(first_file,download_type);
				delete files[first_file];
				wait(2000);
				if (flag && flag == "popup_blocked"){
                }else{
                    localStorage.setItem("download_list",JSON.stringify(files));
                    window.location.reload();
                }
            }else{
                console.log("Going back...");
                login_redirect();
            }
		}
	});
</script>
</header>
<body>
	 <div class="modal fade modal-mini modal-primary" id="redirectModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                        <div class="modal-dialog" style="max-width: 1000px">
                            <div class="modal-content" style="width: 1000px">
                                <div class="modal-header justify-content-center">
                                    <div class="modal-profile">
                                        <i class="nc-icon nc-bell-55"></i>
                                    </div>
                                </div>
                                <div class="modal-body">
                                    <p><center>In order to download, please login or create an account in order to accept DATA USAGE AGREEMENT.</center></p>
                                </div>
                                <div class="modal-footer">
                                    <!--<center><button type="button" onclick="login_redirect();" class="btn btn-success btn-simple btn-link" data-dismiss="modal"><B>Accept</B></button></center>-->
                                        <button type="submit" onclick="window.location.replace('/');" class="btn btn-info btn-fill pull-right" data-dismiss="modal">Login/Register</button>
                                </div>
                            </div>
                        </div>
                    </div>
	 <div class="modal fade modal-mini modal-primary" id="acceptModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                        <div class="modal-dialog" style="max-width: 1000px">
                            <div class="modal-content" style="width: 1000px">
                                <div class="modal-header justify-content-center">
                                    <div class="modal-profile">
                                        <i class="nc-icon nc-bell-55"></i>
                                    </div>
                                </div>
                                <div class="modal-body">
                                    <p><div id="acceptHTML"></div></p>
                                    <br>
                                    Enter your labcas username/password to generate a download script:
                                    <br>
                                    <div class="col-sm-2">Full Name:</div><div class="col-sm-6"><input type="text" id="accept_user" class=".form-control"></input></div>
                                    <div class="col-sm-2">Email:</div><div class="col-sm-6"><input type="text" id="accept_email" class=".form-control"></input></div>
                                    <br>
                                </div>
                                <div class="modal-footer">
                                    <!--<center><button type="button" onclick="login_redirect();" class="btn btn-success btn-simple btn-link" data-dismiss="modal"><B>Accept</B></button></center>-->
                                        <button type="submit" onclick="save_labcas_acceptance('anonymous');" class="btn btn-info btn-fill pull-right" data-dismiss="modal">Accept</button>
                                </div>
                            </div>
                        </div>
                    </div>
	<div class="modal fade modal-mini modal-primary" id="errorModal" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
                        <div class="modal-dialog" style="max-width: 620px">
                            <div class="modal-content" style="width: 620px">
                                <div class="modal-header justify-content-center">
                                    <div id="icon_type" class="modal-profile">
                                        <i class="nc-icon nc-bell-55"></i>
                                    </div>
                                </div>
                                <div class="modal-body">
                                    <center><div id="alertHTML"></div></center>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-link btn-simple" onclick="window.location.replace(Cookies.get('login_redirect'));" data-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
	<div class="modal fade modal-mini modal-primary" id="sizeModal" role="dialog" aria-labelledby="sizelLabel" aria-hidden="false">
                        <div class="modal-dialog" style="max-width: 620px">
                            <div class="modal-content" style="width: 620px">
                                <div class="modal-header justify-content-center">
                                    <div class="modal-profile">
                                        <i class="nc-icon nc-bell-55"></i>
                                    </div>
                                </div>
                                <div class="modal-body">
                                    <div id="sizeHTML"></div>
                                    <br>
                                    <div id="loggedin_download_content">
                                    Enter your labcas username/password to generate a download script:
                                    <br>
                                    <div class="col-sm-2">Username:</div><div class="col-sm-6"><input type="text" id="download_script_user" class=".form-control"></input></div>
                                    <div class="col-sm-2">Password:</div><div class="col-sm-6"><input type="password" id="download_script_pass" class=".form-control"></input></div>
                                    <br>
                                    </div>
                                    <div class="col-sm-12"><font size=3>Click on your OS icon to download relevant download script:</font><br><br>
                                    <center>
                                    <a href="#" onclick="download_script('data_download.ps1','windows');"><img src="/labcas-ui/assets/img/microsoft.png?2" width=50 height=50/></a>
                                    <a href="#" onclick="download_script('data_download.ps1','mac');"><img src="/labcas-ui/assets/img/apple.jpg" width=48 height=48/></a>
                                    <a href="#" onclick="download_script('data_download.ps1','linux');"><img src="/labcas-ui/assets/img/linux.png?2" width=50 height=50/><a/>
                                    </center>
                                    <br>
                                    <button type="button" class="btn btn-warning btn-fill pull-left" onclick="window.location.replace(Cookies.get('login_redirect'));" data-dismiss="modal">Cancel</button>
                                    <button type="submit" onclick='localStorage.setItem("continue_download_flag","True"); window.location.replace("/labcas-ui/download.html");' class="btn btn-danger btn-fill pull-right" data-dismiss="modal">Proceed via Web Browser</button>
                                </div>
                                <div class="modal-footer">
                                    <!--<button type="submit" onclick='localStorage.setItem("continue_download_flag",""); showFileDownloadModal();' class="btn btn-info btn-fill pull-right" data-dismiss="modal">Download via Script</button>-->
                                    <!--<button type="button" class="btn btn-link btn-simple" onclick="resume_download();" data-dismiss="modal">Continue</button>-->
                                </div>
                            </div>
                        </div>
                    </div>
	<div class="modal fade modal-mini modal-primary" id="fileModal" role="dialog" aria-labelledby="sizelLabel" aria-hidden="false">
                        <div class="modal-dialog" style="max-width: 620px">
                            <div class="modal-content" style="width: 620px">
                                <div class="modal-header justify-content-center">
                                    <div class="modal-profile">
                                        <i class="nc-icon nc-bell-55"></i>
                                    </div>
                                </div>
                                <div class="modal-body">
                                    <div id="fileHTML"></div>
                                </div>
                                <div class="modal-footer">
                                    <center><button type="button" id="download_list_link" class="btn btn-link btn-simple" onclick='download_script_files("data_download.ps1",);' >Download Script File List</button></center>
                                    <center><button type="button" class="btn btn-link btn-simple" onclick="window.location.replace(Cookies.get('login_redirect'));" data-dismiss="modal">Done</button></center>
                                </div>
                            </div>
                        </div>
                    </div>
<center><H4>Downloading your files... please wait until complete, window will redirect back to previous page!</H4></center>
</body>
<!--  Google Maps Plugin    -->
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?YOUR_KEY_HERE"></script>
<!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
<script src="/labcas-ui/assets/js/light-bootstrap-dashboard.js?v=2.0.1" type="text/javascript"></script>
<!-- Light Dashboard DEMO methods, don't include it in your project! -->
<script src="/labcas-ui/assets/js/demo.js"></script>
<!--<script src="/labcas-ui/assets/js/labcas/download.js"></script>-->

</html>

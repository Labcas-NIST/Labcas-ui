<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>LabCAS</title>
    <div id="head_template"></div>
  </head>
  <body class="sidebar-mini">
    <div id="ml_wizard_template"></div>
	<div class="wrapper">
		<div id='sidebar_placeholder'></div>
		<div id='load' style="text-align: center;">
			<img class="collapse show" height="200px" width="200px" src="/labcas-ui/assets/img/loading.gif">
		</div>
		<div id="main-panel" class="main-panel" style="visibility:hidden">
			<div id="nav_template"></div>
			<div class="content" style="margin-top: -20px">
				<div class="container-fluid">
					<div class="row" style="margin-bottom: 5px">
						<div class="col-lg-3 col-sm-6" id="collection_name_template"></div>
						<div class="col-lg-3 col-sm-6" id="dataset_stat_template"></div>
						<div class="col-lg-3 col-sm-6" id="file_stat_template"></div>
						<div class="col-lg-3 col-sm-6" id="favorite_stat_template"></div>
					</div>
					<div class="row">
						<div class="col-md-12">
							<nav aria-label="breadcrumb">
								<ol id="breadcrumb" class="breadcrumb"></ol>
							</nav>
						</div>
					</div>
					<div class="row">
						<div class="col-md-12 ml-auto mr-auto" id="collection_level_gantt" style="visibility:hidden">
							<div class="card card-tasks">
								<div class="card-body" style="padding: 0px 15px 10px 15px">
									<iframe frameBorder="0" height="285px" width="100%" src="/labcas-ui/a/gantt.html"></iframe>
								</div>
							</div>
						</div>
						<div class="col-md-12">
							<div class="card">
								<div class="card-header">
									<h4 class="card-title" id="datasettitle"></h4>
									<p class="card-category">Dataset Details</p>
								</div>
								<div class="card-body">
									<div class="table-responsive">
										<table class="table" id="datasetdetails-table">
											<tbody>
												<tr>
													<td style="text-align: center;">
														<img id="loading_dataset" class="collapse show" height="50px" width="50px" src="/labcas-ui/assets/img/loading.gif">
													</td>
												</tr>
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
						<div id='children-datasets' style="display: none" class="col-md-12 ml-auto mr-auto">
							<div class="card card-tasks">
								<div class="card-header">
									<h4 class="card-title" id="children-title">Children Datasets</h4>
								</div>
								<div class="card-body" id="children-datasets-section"></div>
							</div>
						</div>
						<div id='children-files' style="display: none" class="col-md-12 ml-auto mr-auto">
							<div class="card card-tasks">
								<div class="card-header">
									<h4 class="card-title" id="files-title">Files in this Dataset</h4>
								</div>
								<div class="card-body">
									<table>
										<tr>
											<td>
												<button id="download_sel" type="submit" onclick="download_files('files-table');" class="btn btn-primary">Download Selected</button>
											</td>
											<td>&nbsp;&nbsp;</td>
											<td>
												<input id="check_all" type='checkbox' value="all" disabled>&nbsp;All
											</td>
										</tr>
									</table>
									<div class="table-full-width">
										<table class="table" id="files-table" style="table-layout: fixed; padding: 10px">
											<thead id="file-thead">
												<tr>
													<th style="width:5%">Select</th>
													<th data-field="name" data-sortable="true">Name</th>
													<th>Material Code</th>
													<th>Experiment ID</th>
													<th>Study ID</th>
													<th>Experiment Type</th>
													<th>Protocol ID</th>
													<th>Action</th>
												</tr>
											</thead>
											<tbody style="text-align: center;">
												<tr>
													<td colspan="8">
														<img id="loading_file" class="collapse show" height="50px" width="50px" src="/labcas-ui/assets/img/loading.gif">
													</td>
												</tr>
											</tbody>
										</table>
									</div>
								</div>
								<div class="card-footer ">
									<hr>
									<div class="stats">
										<i class="now-ui-icons loader_refresh spin"></i>
										<ul class="pagination pagination-no-border" id='files_pagination_bottom' style="float: right;"></ul>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div id="general_template"></div>
			</div>
			<footer role='contentinfo' class='labcas-footer' id="footer_template"></footer>
		</div>
	</div>

  </body>
  <!--   Core JS Files   -->
  <script src="/labcas-ui/assets/js/core/jquery-3.5.1.min.js" type="text/javascript"></script>
  <script src="/labcas-ui/assets/js/core/popper.min.js" type="text/javascript"></script>
  <script src="/labcas-ui/assets/js/core/bootstrap.min.js" type="text/javascript"></script>
  <!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
  <script src="/labcas-ui/assets/js/plugins/bootstrap-switch.js"></script>
  <!--  Chartist Plugin  -->
  <script src="/labcas-ui/assets/js/plugins/chartist.min.js"></script>
  <!--  Notifications Plugin    -->
  <script src="/labcas-ui/assets/js/plugins/bootstrap-notify.js"></script>
  <!--  jVector Map  -->
  <script src="/labcas-ui/assets/js/plugins/jquery-jvectormap.js" type="text/javascript"></script>
  <!--  Plugin for Date Time Picker and Full Calendar Plugin-->
  <script src="/labcas-ui/assets/js/plugins/moment.min.js"></script>
  <!--  DatetimePicker   -->
  <script src="/labcas-ui/assets/js/plugins/bootstrap-datetimepicker.js"></script>
  <!--  Sweet Alert  -->
  <script src="/labcas-ui/assets/js/plugins/sweetalert2.min.js" type="text/javascript"></script>
  <!--  Tags Input  -->
  <script src="/labcas-ui/assets/js/plugins/bootstrap-tagsinput.js" type="text/javascript"></script>
  <!--  Sliders  -->
  <script src="/labcas-ui/assets/js/plugins/nouislider.js" type="text/javascript"></script>
  <!--  Bootstrap Select  -->
  <script src="/labcas-ui/assets/js/plugins/bootstrap-selectpicker.js" type="text/javascript"></script>
  <!--  jQueryValidate  -->
  <script src="/labcas-ui/assets/js/plugins/jquery.validate.min.js" type="text/javascript"></script>
  <!--  Plugin for the Wizard, full documentation here: https://github.com/VinceG/twitter-bootstrap-wizard -->
  <script src="/labcas-ui/assets/js/plugins/jquery.bootstrap-wizard.js"></script>
  <!--  Bootstrap Table Plugin -->
  <script src="/labcas-ui/assets/js/plugins/bootstrap-table.js"></script>
  <!--  DataTable Plugin -->
  <script src="/labcas-ui/assets/js/plugins/jquery.dataTables.min.js"></script>
  <!--  Full Calendar   -->
  <script src="/labcas-ui/assets/js/plugins/fullcalendar.min.js"></script>
  <!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="/labcas-ui/assets/js/light-bootstrap-dashboard.js?v=2.0.6" type="text/javascript"></script>
  <!-- Light Dashboard DEMO methods, don't include it in your project! -->
  <script src="/labcas-ui/assets/js/plugins/js.cookie.js"></script>
  <script src="/labcas-ui/assets/js/labcas/labcas-sidebar.js"></script>
  <script src="/labcas-ui/assets/js/labcas/utils.js?version=3.0.0"></script>
  <script src="/labcas-ui/assets/js/labcas/authentication.js?version=3.0.0"></script>
  <script src="/labcas-ui/assets/js/labcas/search.js?version=3.0.0"></script>
  <script src="/labcas-ui/assets/js/labcas/datasets.js?version=3.0.4"></script>
  <script src="/labcas-ui/assets/js/labcas/ml_wizard.js?version=3.0.2"></script>

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-X0YH110WES"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-X0YH110WES'); </script>
  <script type="text/javascript">
     document.onreadystatechange = function() {
		var state = document.readyState;
		if (state === 'interactive') {
			document.getElementById('main-panel').style.visibility = "hidden";
		} else if (state === 'complete') {
			setTimeout(function() {
				document.getElementById('load').style.display = "none";
				document.getElementById('main-panel').style.visibility = "visible";
			}, 1000);
		}
	};
	
	$(document).ready(function() {
		initCookies();
		loadTemplates();
		handleUserSession();
		handleBreadcrumbs();
		init_file_checkboxes("files-table");
		init_ml_wizard(get_url_vars()["dataset_id"]);
	});
	
	$("#check_all").change(function() {
		if (this.checked) {
			setDownloadAll();
		} else {
			resetDownloadSelection();
		}
	});
	
	setTimeout(function() {
		var dataset_id_safe = encodeURI(get_url_vars()["dataset_id"].replace(/\\\./g, '.'));
		setup_labcas_dataset_data("datasetfiles", 'id:"' + dataset_id_safe + '"', 'DatasetId:"' + dataset_id_safe + '"', 0);
	}, 1000);
	
	function loadTemplates() {
		$("#head_template").load("/labcas-ui/templates.html #head_template");
		$("#nav_template").load("/labcas-ui/templates.html?version=3.0.0 #nav_template", function() {
			$("#username_placeholder_second").text(Cookies.get('user'));
			$("#loggedout_msg").toggle(Cookies.get('user') === "Sign in");
		});
		$("#favorite_stat_template").load("/labcas-ui/templates.html #favorite_stat_template");
		$("#file_stat_template").load("/labcas-ui/templates.html #file_stat_template");
		$("#collection_name_template").load("/labcas-ui/templates.html #collection_name_template");
		$("#footer_template").load("/labcas-ui/templates.html #footer_template_" + localStorage.getItem("environment_name"));
		$("#sidebar_placeholder").load("/labcas-ui/sidebar_" + localStorage.getItem("environment_name") + ".html?version=3.0.0");
	}
	
	function handleUserSession() {
		var get_var = get_url_vars();
		if (get_var["key"]) {
			Cookies.set("token", get_var["key"]);
			Cookies.set("user", get_var["user"]);
			Cookies.set("userpass", get_var["session"]);
		}
		var dataset_id_safe = encodeURI(get_var["dataset_id"].replace(/\\\./g, '.'));
		Cookies.set("login_redirect", "/labcas-ui/d/index.html?dataset_id=" + dataset_id_safe);
	}
	
	function handleBreadcrumbs() {
		var dataset_id_safe = encodeURI(get_url_vars()["dataset_id"].replace(/\\\./g, '.'));
		var breadcrumb = '<li class="breadcrumb-item"><a href="/labcas-ui/m/index.html">Home</a></li>';
		var data_split = dataset_id_safe.split("/");
		data_split.forEach(function(part, i) {
			var link = i === 0 ? "/labcas-ui/c/index.html?collection_id=" + part :
				"/labcas-ui/d/index.html?dataset_id=" + data_split.slice(0, i + 1).join("/");
			var className = i === data_split.length - 1 ? "active" : "";
			breadcrumb += '<li class="breadcrumb-item ' + className + '" aria-current="page"><a href="' + link + '">' + part.replace(/_/g, " ") + '</a></li>';
		});
		$('#breadcrumb').html(breadcrumb);
	}
	
	function setDownloadAll() {
		var dataset_id = get_url_vars()["dataset_id"];
		$('#download_sel').text("Download All").attr("onclick", "download_dataset('" + dataset_id + "')");
	}
	
	function resetDownloadSelection() {
		$('#download_sel').text("Download Selected").attr("onclick", "download_files('files-table')");
		localStorage.setItem('dicoms', JSON.stringify([]));
		localStorage.setItem('download_list', JSON.stringify({}));
		localStorage.setItem('download_size', 0);
		window.location.reload();
	}
  </script>
</html>

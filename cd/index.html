<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <div id="head_template"></div>
  </head>
  <body class="sidebar-mini">
    <div id="ml_wizard_template"></div>
	<div class="wrapper">
	  <div id='sidebar_placeholder'></div>
	  <div id='load'>
		<center>
		  <img class="collapse show" height="200px" width="200px" src="/labcas-ui/assets/img/loading.gif?2">
		</center>
	  </div>
	  <div id="main-panel" class="main-panel" style="visibility:hidden">
		<div id="nav_template"></div>
		<div class="content" style="margin-top: -20px">
		  <div class="container-fluid">
			<div class="row" style="margin-bottom: 5px">
			  <div class="col-lg-3 col-sm-6" id="file_stat_template"></div>
			</div>
			<div class="row">
			  <div class="col-md-12">
				<nav aria-label="breadcrumb">
				  <ol id="breadcrumb" class="breadcrumb"></ol>
				</nav>
			  </div>
			</div>
			<div class="row">
			  <div class="col-md-12">
				<div class="card">
				  <div class="card-header">
					<h4 class="card-title" id="datasettitle"></h4>
					<p class="card-category">Dataset Details</p>
				  </div>
				  <div class="card-body">
					<button id="virtual_dataset_collapse" class="btn btn-primary">Expand</button>
					<div class="table-responsive">
					  <table class="table" id="datasetdetails-table">
						<tbody>
						  <tr>
							<td colspan="2">
							  <center>
								<img id="loading_dataset" class="collapse show" height="50px" width="50px" src="/labcas-ui/assets/img/loading.gif">
							  </center>
							</td>
						  </tr>
						</tbody>
					  </table>
					</div>
				  </div>
				</div>
			  </div>
			  <div class="col-md-12 ml-auto mr-auto" id="dataset_level_gantt">
				<div class="card card-tasks">
				  <div class="card-header">
					<h4 class="card-title">Cell Line Gantt</h4>
					<p class="card-category">Explore or Download</p>
				  </div>
				  <div class="card-body" style="padding: 0px 15px 10px 15px">
					<iframe id="gantt" frameBorder="0" style="border: none; box-shadow: -2px 2px 2px 2px rgba(0,0,0,0.75); transform: translate(-2px, 2px);" height="350px" width="100%"></iframe>
				  </div>
				</div>
			  </div>
			  <div class="col-md-12 ml-auto mr-auto" id="dataset_level_telemetry">
				<div class="card card-tasks">
				  <div class="card-header">
					<h4 class="card-title">Cell Line Telemetry</h4>
					<p class="card-category">Explore or Download</p>
				  </div>
				  <div class="card-body" style="padding: 0px 15px 10px 15px">
					<iframe id="telemetry" frameBorder="0" style="border: none; box-shadow: -2px 2px 2px 2px rgba(0,0,0,0.75); transform: translate(-2px, 2px);" height="500px" width="100%"></iframe>
				  </div>
				</div>
			  </div>
			  <div class="col-md-12 ml-auto mr-auto" id="datasets_in_collection">
				<div class="card card-tasks">
				  <div class="card-header">
					<h4 class="card-title">Virtual Hierarchy in this Dataset</h4>
				  </div>
				  <div class="card-body">
					<p>Add Folder Grouping Hierarchy:</p>
					<hr style="padding:0; padding-bottom:5px; margin: 0">
					<input id="view_tags" type="text" value="1. Cohort,2. Fixative,3. Study" />
					<div class="row">
					  <div class="col-md-10">
						<select id="view_tag_select" class="form-control input-sm" data-style="btn-default btn-outline" data-menu-style="dropdown-blue">
						  <option>Default</option>
						</select>
					  </div>
					  <div class="col-md-2" id="virtual_expand_all_label" style="line-height: 36px; display: none">
						<input type="checkbox" id="virtual_expand_all" class="form-control" style="width:36px;height:36px"> Expand All?
					  </div>
					</div>
					<div id="hierarchy_">
					  <center><img alt='Please wait while this is loading' id="loading_hierarchy" class="collapse hide" height="50px" width="50px" src="/labcas-ui/assets/img/loading.gif"></center>
					</div>
				  </div>
				</div>
			  </div>
			  <div id='children-datasets' style="display: none" class="col-md-12 ml-auto mr-auto">
				<div class="card card-tasks">
				  <div class="card-header">
					<h4 class="card-title" id="files-title">Children Datasets</h4>
				  </div>
				  <div class="card-body" id="children-datasets-section"></div>
				</div>
			  </div>
			  <div id='children-files' style="display: none" class="col-md-12 ml-auto mr-auto">
				<div class="card card-tasks">
				  <div class="card-header">
					<h4 class="card-title" id="files-title">Files in this hierarchy</h4>
				  </div>
				  <div class="card-body">
					<table>
					  <tr>
						<td>
						  <button id="download_sel" type="submit" onclick="download_files('files-table');" class="btn btn-primary">Download Selected</button>
						  <button id="download_met" type="submit" onclick="download_metadatas('files-table');" class="btn btn-primary">Download Metadata</button>
						</td>
						<td>
						  <input id="check_all" type='checkbox' value="all"> All
						</td>
					  </tr>
					</table>
					<ul class="pagination pagination-no-border" id='hierarchy_files_pagination_top' style="float: right;"></ul>
					<div class="table-full-width">
					  <table class="table" id="files-table" style="table-layout: fixed; padding: 10px">
						<thead></thead>
						<tbody>
						  <center>
							<img id="loading_file" class="collapse show" height="50px" width="50px" src="/labcas-ui/assets/img/loading.gif">
						  </center>
						</tbody>
					  </table>
					</div>
				  </div>
				  <div class="card-footer">
					<hr>
					<div class="stats">
					  <i class="now-ui-icons loader_refresh spin"></i>
					  <ul class="pagination pagination-no-border" id='hierarchy_files_pagination_bottom' style="float: right;"></ul>
					</div>
				  </div>
				</div>
			  </div>
			</div>
		  </div>
		</div>
	  </div>
	  <footer role='contentinfo' class='labcas-footer' id="footer_template"></footer>
	</div>
	
	<div class="modal fade modal-mini modal-primary" id="redirectModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	  <div class="modal-dialog" style="max-width: 1000px">
		<div class="modal-content" style="width: 1000px">
		  <div class="modal-header justify-content-center">
			<div class="modal-profile">
			  <i class="nc-icon nc-bell-55"></i>
			</div>
		  </div>
		  <div class="modal-body">
			<center><div id='download_warning'></div></center>
		  </div>
		  <div class="modal-footer">
			<button type="submit" id="redirectModal_continue" onclick="window.location.replace('/labcas-ui/download.html?version=3.0.0')" class="btn btn-info btn-fill pull-right" data-dismiss="modal">Continue</button>
			<button type="submit" class="btn btn-warning btn-fill pull-right" data-dismiss="modal">Close</button>
		  </div>
		</div>
	  </div>
	</div>

  </body>
  <!--   Core JS Files   -->
  <script src="/labcas-ui/assets/js/core/jquery-3.5.1.min.js" type="text/javascript"></script>
  <script src="/labcas-ui/assets/js/core/popper.min.js" type="text/javascript"></script>
  <script src="/labcas-ui/assets/js/core/bootstrap.min.js" type="text/javascript"></script>
  <!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
  <script src="/labcas-ui/assets/js/plugins/bootstrap-switch.js"></script>
  <!--  Chartist Plugin  -->
  <script src="/labcas-ui/assets/js/plugins/chartist.min.js"></script>
  <!--  Notifications Plugin    -->
  <script src="/labcas-ui/assets/js/plugins/bootstrap-notify.js"></script>
  <!--  jVector Map  -->
  <script src="/labcas-ui/assets/js/plugins/jquery-jvectormap.js" type="text/javascript"></script>
  <!--  Plugin for Date Time Picker and Full Calendar Plugin-->
  <script src="/labcas-ui/assets/js/plugins/moment.min.js"></script>
  <!--  DatetimePicker   -->
  <script src="/labcas-ui/assets/js/plugins/bootstrap-datetimepicker.js"></script>
  <!--  Sweet Alert  -->
  <script src="/labcas-ui/assets/js/plugins/sweetalert2.min.js" type="text/javascript"></script>
  <!--  Tags Input  -->
  <script src="/labcas-ui/assets/js/plugins/bootstrap-tagsinput.js" type="text/javascript"></script>
  <!--  Sliders  -->
  <script src="/labcas-ui/assets/js/plugins/nouislider.js" type="text/javascript"></script>
  <!--  Bootstrap Select  -->
  <script src="/labcas-ui/assets/js/plugins/bootstrap-selectpicker.js" type="text/javascript"></script>
  <!--  jQueryValidate  -->
  <script src="/labcas-ui/assets/js/plugins/jquery.validate.min.js" type="text/javascript"></script>
  <!--  Plugin for the Wizard, full documentation here: https://github.com/VinceG/twitter-bootstrap-wizard -->
  <script src="/labcas-ui/assets/js/plugins/jquery.bootstrap-wizard.js"></script>
  <!--  Bootstrap Table Plugin -->
  <script src="/labcas-ui/assets/js/plugins/bootstrap-table.js"></script>
  <!--  DataTable Plugin -->
  <script src="/labcas-ui/assets/js/plugins/jquery.dataTables.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
  <!--  Full Calendar   -->
  <script src="/labcas-ui/assets/js/plugins/fullcalendar.min.js"></script>
  <!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="/labcas-ui/assets/js/light-bootstrap-dashboard.js?v=2.0.6" type="text/javascript"></script>
  <script src="/labcas-ui/assets/js/plugins/js.cookie.js"></script>
  <script src="/labcas-ui/assets/js/labcas/labcas-sidebar.js"></script>
  <script src="/labcas-ui/assets/js/labcas/utils.js?version=3.0.5"></script>
  <script src="/labcas-ui/assets/js/labcas/hierarchy_filter_utils_fast.js?version=3.0.3"></script>
  <script src="/labcas-ui/assets/js/labcas/authentication.js?version=3.0.0"></script>
  <script src="/labcas-ui/assets/js/labcas/search.js?version=3.0.0"></script>
  <script src="/labcas-ui/assets/js/labcas/ml_wizard.js?version=3.0.3"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
  <script src="/labcas-ui/assets/js/plugins/typeahead.bundle.js"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-X0YH110WES"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-X0YH110WES'); </script>
  <script type="text/javascript">
    var get_var = get_url_vars();

	document.onreadystatechange = function() {
		var state = document.readyState;
		if (state === 'interactive') {
			document.getElementById('main-panel').style.visibility = "hidden";
		} else if (state === 'complete') {
			setTimeout(function() {
				document.getElementById('load').style.display = "none";
				document.getElementById('main-panel').style.visibility = "visible";
			}, 1000);
		}
	};
	
	$(document).ready(function() {
		initCookies();
	
		$("#head_template").load("/labcas-ui/templates.html #head_template");
		$("#nav_template").load("/labcas-ui/templates.html?version=3.0.0 #nav_template", function() {
			$("#username_placeholder_second").text(Cookies.get('user'));
			$("#loggedout_msg").toggle(Cookies.get('user') === "Sign in");
		});
	
		$("#file_stat_template").load("/labcas-ui/templates.html #file_stat_template");
		$("#dataset_stat_template").load("/labcas-ui/templates.html?version=3.0.0 #dataset_name_template");
		$("#collection_name_template").load("/labcas-ui/templates.html #collection_name_template");
		$("#footer_template").load("/labcas-ui/templates.html #footer_template_" + localStorage.getItem("environment_name"));
		$("#sidebar_placeholder").load("/labcas-ui/sidebar_" + localStorage.getItem("environment_name") + ".html?version=3.0.0");
	
		if (get_var["key"]) {
			Cookies.set("token", get_var["key"]);
			Cookies.set("user", get_var["user"]);
			Cookies.set("userpass", get_var["session"]);
		}
	
		Cookies.set("login_redirect", "/labcas-ui/cd/index.html");
	
		var hierarchy = JSON.parse(localStorage.getItem("hierarchy_dict_current"));
	
		// Cell Line specific code
		let cellCodeIndex = hierarchy[0].indexOf("MammalianCellCode");
		if (cellCodeIndex !== -1) {
			let cellCodeValue = hierarchy[1][cellCodeIndex];
			let url = "/labcas-ui/a/gantt-new-single.html?cellcode=" + cellCodeValue;
			let url_telemetry = "/labcas-ui/a/telemtry_dash.html?cellcode=" + cellCodeValue;
	
			$("#gantt").attr("src", url);
			$("#telemetry").attr("src", url_telemetry);
			$("#dataset_level_gantt, #dataset_level_telemetry").show();
		} else {
			console.log("'CellCode' not found in the first row of the JSON data");
			$("#dataset_level_gantt, #dataset_level_telemetry").hide();
		}
	
		if (get_var["backtrack_ind"]) {
			hierarchy[0] = hierarchy[0].slice(0, parseInt(get_var["backtrack_ind"]) + 1);
			hierarchy[1] = hierarchy[1].slice(0, parseInt(get_var["backtrack_ind"]) + 1);
		}
	
		if (!localStorage.getItem('last_collection_id').includes("NIST_Flow_Cytometry_Standards_Consortium")){
			$('#fcs_sel').hide();
		}
	
		setupBreadcrumbs(hierarchy);
	
		setupViewTags();
	
		localStorage.setItem("current_dataset_id", get_var["dataset_id"]);
		init_file_checkboxes("files-table");
		init_ml_wizard(localStorage.getItem('last_collection_id'));
		setup_labcas_hierarchy_data(buildFileQuery(hierarchy), [], 0);
	});
	
	$("#check_all").change(function() {
		if (this.checked) {
			$('#download_sel').text("Download All").attr("onclick", "download_dataset('hierarchy_query')");
			$('#download_met').text("Download All Metadata").attr("onclick", "download_metadatas('hierarchy_query')");
		} else {
			resetDownloads();
		}
	});
	
	function setupBreadcrumbs(hierarchy) {
		var breadcrumb_hierarchy = [];
		var file_query = "";
		hierarchy[0].forEach(function(item, i) {
			if (hierarchy[1][i] !== "None") {
				file_query += "&fq=(" + encodeURI(hierarchy[0][i]) + ":" + encodeURI(hierarchy[1][i]) + ")";
			} else {
				file_query += "&fq=(-" + encodeURI(hierarchy[0][i]) + ":* TO *)";
			}
			breadcrumb_hierarchy.push(hierarchy[0][i] + ": " + hierarchy[1][i]);
		});
		localStorage.setItem("hierarchy_file_query", file_query);
		var breadcrumb = '<li class="breadcrumb-item"><a href="/labcas-ui/m/index.html">Home</a></li>';
		breadcrumb_hierarchy.forEach(function(item, index) {
			var link = index === 0 ? "/labcas-ui/c/index.html?collection_id=" + localStorage.getItem('last_collection_id') : "/labcas-ui/cd/index.html?backtrack_ind=" + index;
			breadcrumb += '<li class="breadcrumb-item active" aria-current="page"><a href="' + link + '">' + item + '</a></li>';
		});
		$('#breadcrumb').html(breadcrumb);
	}
	
	function resetDownloads() {
		$('#download_sel').text("Download Selected").attr("onclick", "download_files('files-table')");
		$('#download_met').text("Download Metadata").attr("onclick", "download_metadatas('files-table')");
		localStorage.setItem('dicoms', JSON.stringify([]));
		localStorage.setItem('download_list', JSON.stringify({}));
		localStorage.setItem('download_size', 0);
		window.location.reload();
	}

  </script>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <div id="head_template"></div>
  </head>
  <body class="sidebar-mini">
    <div class="wrapper">
      <div id='sidebar_placeholder'></div>
      <div id='load'>
        <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
        <center>
          <img class="collapse show" height="200px" width="200px" src="/nist/assets/img/loading.gif?2">
        </center>
      </div>
      <div id="main-panel" class="main-panel" style="visibility:hidden">
        <!-- Navbar -->
        <div id="nav_template"></div>
        <!-- End Navbar -->
        <div class="content" style="margin-top: -20px">
          <br>
          <br>
          <br>
          <div class="container-fluid">
            <div class="row" style="margin-bottom: 5px">
              <div class="col-lg-3 col-sm-6" id="file_stat_template"></div>
              <div class="col-lg-3 col-sm-6" id="favorite_stat_template"></div>
            </div>
            <div class="row">
              <div class="col-md-12">
                <nav aria-label="breadcrumb">
                  <ol id="breadcrumb" class="breadcrumb"></ol>
                </nav>
              </div>
            </div>
            <div class="row">
              <div id='children-datasets' style="display: none" class="col-md-12 ml-auto mr-auto">
                <div class="card card-tasks">
                  <div class="card-header ">
                    <h4 class="card-title" id="files-title">Children Datasets</h4>
                  </div>
                  <div class="card-body" id="children-datasets-section"></div>
                </div>
              </div>
              <div id='children-files' style="display: none" class="col-md-12 ml-auto mr-auto">
                <div class="card card-tasks">
                  <div class="card-header ">
                    <h4 class="card-title" id="files-title">Files in this hierarchy</h4>
                  </div>
                  <div class="card-body">
                    <table>
                      <tr>
                        <td>
                          <button id="download_sel" type="submit" onclick="download_files('files-table');" class="btn btn-primary">Download Selected</button>
			  <!--<button id="dicom_sel" type="submit" onclick="submitImage('files-table')" class="btn btn-success">View Selected Image(s)</button>-->
                        </td>
                        <td>
                          <input id="check_all" type='checkbox' value="all">&nbsp;All</input>
                        </td>
                      </tr>
                    </table>
                    <ul class="pagination pagination-no-border" id='hierarchy_files_pagination_top' style="float: right;"></ul>
                    <div class="table-full-width">
                      <table class="table" id="files-table" style="table-layout: fixed; padding: 10px">
                        <thead></thead>
                        <tbody>
                          <center>
                            <img id="loading_file" class="collapse show" height="50px" width="50px" src="/nist/assets/img/loading.gif">
                          </center>
                        </tbody>
                      </table>
                    </div>
                  </div>
                  <div class="card-footer ">
                    <hr>
                    <div class="stats">
                      <i class="now-ui-icons loader_refresh spin"></i>
                      <ul class="pagination pagination-no-border" id='hierarchy_files_pagination_bottom' style="float: right;"></ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <footer role='contentinfo' class='labcas-footer' id="footer_template"></footer>
      </div>
    </div>
    </div>
    </div>
  </body>
  <!--   Core JS Files   -->
  <script src="/nist/assets/js/core/jquery-3.5.1.min.js" type="text/javascript"></script>
  <script src="/nist/assets/js/core/popper.min.js" type="text/javascript"></script>
  <script src="/nist/assets/js/core/bootstrap.min.js" type="text/javascript"></script>
  <!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
  <script src="/nist/assets/js/plugins/bootstrap-switch.js"></script>
  <!--  Chartist Plugin  -->
  <script src="/nist/assets/js/plugins/chartist.min.js"></script>
  <!--  Notifications Plugin    -->
  <script src="/nist/assets/js/plugins/bootstrap-notify.js"></script>
  <!--  jVector Map  -->
  <script src="/nist/assets/js/plugins/jquery-jvectormap.js" type="text/javascript"></script>
  <!--  Plugin for Date Time Picker and Full Calendar Plugin-->
  <script src="/nist/assets/js/plugins/moment.min.js"></script>
  <!--  DatetimePicker   -->
  <script src="/nist/assets/js/plugins/bootstrap-datetimepicker.js"></script>
  <!--  Sweet Alert  -->
  <script src="/nist/assets/js/plugins/sweetalert2.min.js" type="text/javascript"></script>
  <!--  Tags Input  -->
  <script src="/nist/assets/js/plugins/bootstrap-tagsinput.js" type="text/javascript"></script>
  <!--  Sliders  -->
  <script src="/nist/assets/js/plugins/nouislider.js" type="text/javascript"></script>
  <!--  Bootstrap Select  -->
  <script src="/nist/assets/js/plugins/bootstrap-selectpicker.js" type="text/javascript"></script>
  <!--  jQueryValidate  -->
  <script src="/nist/assets/js/plugins/jquery.validate.min.js" type="text/javascript"></script>
  <!--  Plugin for the Wizard, full documentation here: https://github.com/VinceG/twitter-bootstrap-wizard -->
  <script src="/nist/assets/js/plugins/jquery.bootstrap-wizard.js"></script>
  <!--  Bootstrap Table Plugin -->
  <script src="/nist/assets/js/plugins/bootstrap-table.js"></script>
  <!--  DataTable Plugin -->
  <script src="/nist/assets/js/plugins/jquery.dataTables.min.js"></script>
  <!--  Full Calendar   -->
  <script src="/nist/assets/js/plugins/fullcalendar.min.js"></script>
  <!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="/nist/assets/js/light-bootstrap-dashboard.js?v=2.0.6" type="text/javascript"></script>
  <script src="/nist/assets/js/plugins/js.cookie.js"></script>
  <script src="/nist/assets/js/labcas/labcas-sidebar.js"></script>
  <script src="/nist/assets/js/labcas/utils.js?version=3.0.0"></script>
  <script src="/nist/assets/js/labcas/hierarchy_filter_utils.js?version=3.0.0"></script>
  <script src="/nist/assets/js/labcas/authentication.js?version=3.0.0"></script>
  <script src="/nist/assets/js/labcas/search.js?version=3.0.0"></script>
  <script type="text/javascript">
    document.onreadystatechange = function() {
      var state = document.readyState
      if (state == 'interactive') {
        document.getElementById('main-panel').style.visibility = "hidden";
      } else if (state == 'complete') {
        setTimeout(function() {
          document.getElementById('load').style.display = "none";
          document.getElementById('main-panel').style.visibility = "visible";
        }, 1000);
      }
    }

    $(document).ready(function() {
      initCookies();
      $("#head_template").load("/nist/templates.html #head_template");
      $("#nav_template").load("/nist/templates.html?version=3.0.0 #nav_template", function() {
        $("#username_placeholder_second").text(Cookies.get('user'));
        if (Cookies.get('user') == "Sign in") {
          $("#username_placeholder_third").text(Cookies.get('user'));
          $("#loggedout_msg").show();
        } else {
          $("#loggedout_msg").hide();
        }
      });
      $("#favorite_stat_template").load("/nist/templates.html #favorite_stat_template");
      $("#file_stat_template").load("/nist/templates.html #file_stat_template");
      $("#dataset_stat_template").load("/nist/templates.html?version=3.0.0 #dataset_name_template");
      $("#collection_name_template").load("/nist/templates.html #collection_name_template");
      $("#footer_template").load("/nist/templates.html #footer_template_" + localStorage.getItem("environment_name"));
      $("#sidebar_placeholder").load("/nist/sidebar_" + localStorage.getItem("environment_name") + ".html?version=3.0.0");
      
      var get_var = get_url_vars();
      if (get_var["key"]) {
        Cookies.set("token", get_var["key"]);
        Cookies.set("user", get_var["user"]);
        Cookies.set("userpass", get_var["session"]);
      }
      
      Cookies.set("login_redirect", "/nist/cd/index.html");
      var hierarchy = JSON.parse(localStorage.getItem("hierarchy_dict_current"));
      if (get_var["backtrack_ind"]) {
        hierarchy[0] = hierarchy[0].slice(0, parseInt(get_var["backtrack_ind"]) + 1)
        hierarchy[1] = hierarchy[1].slice(0, parseInt(get_var["backtrack_ind"]) + 1)
      }
      var file_query = "";
      var file_query_tmp = {};
      var breadcrumb_hierarchy = [];
      for (var i = 0; i < hierarchy[0].length; i++) {
        file_query += "&fq=(" + encodeURI(escapeRegExp(hierarchy[0][i])).replace(/:/g, '%3A').replace(/%5C&/g, '%5C%26') + ":" + encodeURI(escapeRegExp(String(hierarchy[1][i]))).replace(/%5C&/g, '%5C%26') + ")";
        file_query_tmp[encodeURI(escapeRegExp(hierarchy[0][i])).replace(/:/g, '%3A').replace(/%5C&/g, '%5C%26')] = encodeURI(escapeRegExp(String(hierarchy[1][i]))).replace(/%5C&/g, '%5C%26');
        breadcrumb_hierarchy.push(hierarchy[0][i] + ": " + String(hierarchy[1][i]));
      }
      localStorage.setItem("hierarchy_file_query", file_query);
      setup_labcas_hierarchy_data(file_query, 0);
      var breadcrumb = '<li class="breadcrumb-item"><a href="/nist/m/index.html">Home</a></li>';
      var data_split = breadcrumb_hierarchy;
      var url_prefix = "";
      for (i = 0; i < data_split.length; i++) {
        if (i == 0) {
	  breadcrumb += '<li class="breadcrumb-item active" aria-current="page"><a href="/nist/c/index.html?collection_id='+localStorage.getItem('last_collection_id')+'">'+localStorage.getItem('last_collection_id').replace(/_/g," ")+'</a></li>';
          breadcrumb += '<li class="breadcrumb-item active" aria-current="page"><a href="/nist/cd/index.html?backtrack_ind='+i+'">'+data_split[i].replace(/_/g," ")+'</a></li>';
        } else if (i == data_split.length - 1) {
	  breadcrumb += '<li class="breadcrumb-item active" aria-current="page">'+data_split[i].replace(/_/g," ")+'</li>';
        } else {
           breadcrumb += '<li class="breadcrumb-item active" aria-current="page"><a href="/nist/cd/index.html?backtrack_ind='+i+'">'+data_split[i].replace(/_/g," ")+'</a></li>';
        }
      }
      $('#breadcrumb').html(breadcrumb);
      
      //Init shopping cart
      init_file_checkboxes("files-table");
    });
    $("#check_all").change(function() {
      if (this.checked) {
        $('#download_sel').text("Download All");
        $('#download_sel').attr("onclick", "download_dataset('hierarchy_query')");
      } else {
        $('#download_sel').text("Download Selected");
        $('#download_sel').attr("onclick", "download_files('files-table')");
        localStorage.setItem('dicoms', JSON.stringify([]));
        localStorage.setItem('download_list', JSON.stringify({}));
        localStorage.setItem('download_size', 0);
        window.location.reload();
      }
    });
  </script>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <div id="head_template"></div>
  </head>
  <body class="sidebar-mini">
    <div class="wrapper">
      <div id='sidebar_placeholder'></div>
      <div id='load'>
        <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
        <center>
          <img class="collapse show" height="200px" width="200px" src="/labcas-ui/assets/img/loading.gif">
        </center>
      </div>
      <div id="main-panel" class="main-panel" style="visibility:hidden">
        <!-- Navbar -->
        <div id="nav_template"></div>
        <!-- End Navbar -->
        <div class="content">
          <br>
          <br>
          <div class="container-fluid">
            <div class="row">
              <div class="col-lg-3 col-sm-6">
                <div class="card card-stats">
                  <div class="card-body ">
                    <div class="row">
                      <div class="col-5">
                        <div class="icon-big text-center icon-warning">
                          <a href="#">
                            <i id='download_icon' class="fa fa-download text-success"></i>
                          </a>
                        </div>
                      </div>
                      <div class="col-7">
                        <div class="numbers">
                          <p class="card-category">Download</p>
                        </div> Size: <div id="filesize"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-lg-3 col-sm-6">
                <div class="card card-stats">
                  <div class="card-body ">
                    <div class="row">
                      <div class="col-5">
                        <div class="icon-big text-center icon-warning">
                          <a href="#">
                            <i id='download_metadata_icon' class="fa fa-download text-info"></i>
                          </a>
                        </div>
                      </div>
                      <div class="col-7">
                        <div class="numbers">
                          <p class="card-category">Download Metadata</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-lg-3 col-sm-6" id="image_viewer_link">
                <div class="card card-stats">
                  <div class="card-body ">
                    <div class="row">
                      <div class="col-5">
                        <div class="icon-big text-center icon-warning">
                          <a href="#" id="viewer_wrapper">
                            <i id='viewer_icon' class="fa fa-image text-info"></i>
                          </a>
                        </div>
                      </div>
                      <div class="col-7">
                        <div class="numbers">
                          <p class="card-category">View Image</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-lg-3 col-sm-6" id="pdf_viewer_link">
                <div class="card card-stats">
                  <div class="card-body ">
                    <div class="row">
                      <div class="col-5">
                        <div class="icon-big text-center icon-warning">
                          <a href="#" id="pdf_wrapper">
                            <i id='pdf_icon' class="fa fa-file-pdf-o text-info"></i>
                          </a>
                        </div>
                      </div>
                      <div class="col-7">
                        <div class="numbers">
                          <p class="card-category">View PDF</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-12">
                <nav aria-label="breadcrumb">
                  <ol id="breadcrumb" class="breadcrumb"></ol>
                </nav>
              </div>
            </div>
            <div class="row">
              <div class="col-md-12">
                <div class="card ">
                  <div class="card-header">
                    <h4 class="card-title">
                      <div id="filetitle"></div>
                    </h4>
                    <p class="card-category">File Details</p>
                  </div>
                  <div class="card-body">
                    <div class="table-responsive">
                      <table class="table" id="filedetails-table" style="table-layout: fixed;">
                        <tbody>
                          <center>
                            <img id="loading" class="collapse show" height="50px" width="50px" src="/labcas-ui/assets/img/loading.gif">
                          </center>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div id="general_template"></div>
          </div>
          <footer role='contentinfo' class='labcas-footer' id="footer_template"></footer>
        </div>
      </div>
    </div>
    </div>
    </div>
  </body>
  <!--   Core JS Files   -->
  <script src="/labcas-ui/assets/js/core/jquery-3.5.1.min.js" type="text/javascript"></script>
  <script src="/labcas-ui/assets/js/core/popper.min.js" type="text/javascript"></script>
  <script src="/labcas-ui/assets/js/core/bootstrap.min.js" type="text/javascript"></script>
  <!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
  <script src="/labcas-ui/assets/js/plugins/bootstrap-switch.js"></script>
  <!--  Chartist Plugin  -->
  <script src="/labcas-ui/assets/js/plugins/chartist.min.js"></script>
  <!--  Notifications Plugin    -->
  <script src="/labcas-ui/assets/js/plugins/bootstrap-notify.js"></script>
  <!--  jVector Map  -->
  <script src="/labcas-ui/assets/js/plugins/jquery-jvectormap.js" type="text/javascript"></script>
  <!--  Plugin for Date Time Picker and Full Calendar Plugin-->
  <script src="/labcas-ui/assets/js/plugins/moment.min.js"></script>
  <!--  DatetimePicker   -->
  <script src="/labcas-ui/assets/js/plugins/bootstrap-datetimepicker.js"></script>
  <!--  Sweet Alert  -->
  <script src="/labcas-ui/assets/js/plugins/sweetalert2.min.js" type="text/javascript"></script>
  <!--  Tags Input  -->
  <script src="/labcas-ui/assets/js/plugins/bootstrap-tagsinput.js" type="text/javascript"></script>
  <!--  Sliders  -->
  <script src="/labcas-ui/assets/js/plugins/nouislider.js" type="text/javascript"></script>
  <!--  Bootstrap Select  -->
  <script src="/labcas-ui/assets/js/plugins/bootstrap-selectpicker.js" type="text/javascript"></script>
  <!--  jQueryValidate  -->
  <script src="/labcas-ui/assets/js/plugins/jquery.validate.min.js" type="text/javascript"></script>
  <!--  Plugin for the Wizard, full documentation here: https://github.com/VinceG/twitter-bootstrap-wizard -->
  <script src="/labcas-ui/assets/js/plugins/jquery.bootstrap-wizard.js"></script>
  <!--  Bootstrap Table Plugin -->
  <script src="/labcas-ui/assets/js/plugins/bootstrap-table.js"></script>
  <!--  DataTable Plugin -->
  <script src="/labcas-ui/assets/js/plugins/jquery.dataTables.min.js"></script>
  <!--  Full Calendar   -->
  <script src="/labcas-ui/assets/js/plugins/fullcalendar.min.js"></script>
  <!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="/labcas-ui/assets/js/light-bootstrap-dashboard.js?v=2.0.1" type="text/javascript"></script>
  <link href="/labcas-ui/assets/css/labcas/custom.css" rel="stylesheet" />
  <script src="/labcas-ui/assets/js/plugins/js.cookie.js"></script>
  <script src="/labcas-ui/assets/js/labcas/labcas-sidebar.js"></script>
  <script src="/labcas-ui/assets/js/labcas/authentication.js?version=3.0.1"></script>
  <script src="/labcas-ui/assets/js/labcas/utils.js?version=3.0.0"></script>
  <script src="/labcas-ui/assets/js/labcas/search.js?version=3.0.0"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-X0YH110WES"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-X0YH110WES'); </script>
  <script type="text/javascript">
    document.onreadystatechange = function() {
		updatePageVisibility();
	};
	
	$(document).ready(function() {
		initPage();
	});
	
	function updatePageVisibility() {
		const state = document.readyState;
		if (state === 'interactive') {
			document.getElementById('main-panel').style.visibility = "hidden";
		} else if (state === 'complete') {
			setTimeout(() => {
				document.getElementById('load').style.display = "none";
				document.getElementById('main-panel').style.visibility = "visible";
			}, 1000);
		}
	}
	
	function initPage() {
		initCookies();
		loadTemplates();
		setLoginRedirection();
		setUpFileData();
		configureLinksBasedOnFileType();
		setTimeout(() => init_file_checkboxes('none'), 1000);
	}
	
	function loadTemplates() {
		$("#head_template").load("/labcas-ui/templates.html?version=3.0.0 #head_template");
		$("#nav_template").load("/labcas-ui/templates.html?version=3.0.0 #nav_template", updateUserInfo);
		$("#footer_template").load("/labcas-ui/templates.html #footer_template_" + localStorage.getItem("environment_name"));
		$("#sidebar_placeholder").load("/labcas-ui/sidebar_" + localStorage.getItem("environment_name") + ".html?version=3.0.0");
	}
	
	function updateUserInfo() {
		const user = Cookies.get('user');
		$("#username_placeholder_second").text(user);
		if (user === "Sign in") {
			$("#username_placeholder_third").html(user);
			$("#loggedout_msg").show();
		} else {
			$("#loggedout_msg").hide();
		}
	}
	
	function setLoginRedirection() {
		const file_id = localStorage.getItem("file_id") || get_url_vars()["file_id"];
		Cookies.set("login_redirect", `/labcas-ui/f/index.html?file_id=${file_id}`);
	}
	
	function setUpFileData() {
		const file_id = localStorage.getItem("file_id");
		const encodedFileId = encodeURIComponent(file_id).replace(/&/g, "%26").replace(/\+/g, "%2B").replace(/#/g, "%23");
		setup_labcas_file_data("file", `id:"${encodedFileId}"`, `id:${file_id}*`);
		updateBreadcrumb(file_id);
	}
	
	function updateBreadcrumb(file_id) {
		const data_split = file_id.split("/");
		let breadcrumb = '<li class="breadcrumb-item"><a href="/labcas-ui/m/index.html">Home</a></li>';
		let is_collection_file = false;
	
		data_split.forEach((part, index) => {
			if (index === 0 || !is_collection_file) {
				const link = index === data_split.length - 1 ? `${part.replace(/_/g, " ")}` : `/labcas-ui/c/index.html?collection_id=${part}`;
				breadcrumb += `<li class="breadcrumb-item active" aria-current="page"><a href="${link}">${part.replace(/_/g, " ")}</a></li>`;
			}
			if (index === 1 && part === data_split[0]) {
				is_collection_file = true;
			}
		});
	
		$('#breadcrumb').html(breadcrumb);
	}
	
	function configureLinksBasedOnFileType() {
		const file_id = localStorage.getItem("file_id");
		if (file_id.toLowerCase().endsWith(".pdf")) {
			$("#pdf_viewer_link").show().attr("onclick", `pdf_viewer('${file_id}')`);
		} else if ([".png", ".jpg", ".jpeg"].some(ext => file_id.toLowerCase().endsWith(ext))) {
			$('#image_viewer_link').show();
		}
	}
  </script>
</html>
